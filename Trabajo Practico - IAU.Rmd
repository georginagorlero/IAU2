---
title: "Trabajo Práctico - IAU2"
output: html_document
---

# Trabajo Práctico - Instrumentos de Análisis Urbano 2

En este trabajo voy a analizar las modificaciones en el uso de las bicicletas "Ecobici" del Gobierno de la Ciudad de Buenos Aires durante la pandemia por Covid-19 en el micro y macrocentro porteño.

## 1. Primer paso - Cargar los datasets.

```{r}
library(dplyr)
library(tidyverse)
library(sf)
library(vroom)
library(lubridate)
```

```{r}
recorridos_2019 <- vroom("data/recorridos-realizados-2019.csv")
recorridos_2020 <- vroom("data/recorridos-realizados-2020.csv")
```

```{r}
barrios <- st_read("data/barrios_badata.shp")
```

## 2. Segundo paso - Ordenar y procesar los datos.

Vamos a ver que información traen nuestros datos

```{r}
colnames(recorridos_2019)
```

```{r}
colnames(recorridos_2020)
```
Cuando comparamos las columnas de los datos de 2019 y 2020 vemos que son prácticamente las mismas. Podemos observar que en el dataset de 2020 ya no viene la columna genero_usuario y que las columnas domicilio pasaron a denominarse dirección. Vamos a modificarlas para que tengan el mismo nombre

```{r}
recorridos_2019 <- rename(recorridos_2019, direccion_estacion_origen = domicilio_estacion_origen, direccion_estacion_destino = domicilio_estacion_destino ) %>% 
                   select(-genero_usuario)
```

Ya unificamos los nombres de todas las columnas en ambos datasets y eliminamos la columna género. 

Como nuestros datasets son muy grandes, vamos a quedarnos sólo con los recorridos de  marzo, abril y mayo de cada uno de los años. 

```{r}
recorridos_2019_fma <- recorridos_2019 %>%
                   mutate(mes=month(fecha_destino_recorrido, label=TRUE, abbr=TRUE, locale="Spanish"))%>%
                   filter(mes %in% c("mar","abr","may"))
                  
```

Pasamos de tener más de 6 millones de observaciones a tener 981 mil, un número mucho más manejable

Hacemos lo mismo con el dataset de 2020

```{r}
recorridos_2020_fma <- recorridos_2020 %>%
                   mutate(mes=month(fecha_destino_recorrido, label=TRUE, abbr=TRUE, locale="Spanish"))%>%
                   filter(mes %in% c("mar","abr","may"))
                  
```

Ya nos podemos ir anticipando del impacto que causó el covid en el uso de las Ecobicis viendo que el resultado de filtrar nuestro dataset da 73mil observaciones, un número muy menor al que nos da en 2019

Podemos ver también qué tipo de datos tiene cada una de las columnas

```{r}
str(recorridos_2019)
```
```{r}
summary(recorridos_2019)
```

Para una primera aproximación voy a ver solamente las estaciones destino, ver cuales son las 10 estaciones más recurrentes como destino final en el 2019 y en el 2020.

Para esto primero me quedo sólo con las columnas que me interesan que son aquellas que tienen que ver con el destino de los recorridos. Además, saco todas aquellas observaciones que no tienen latitud (y por ende tampoco longitud)

```{r}
resumen_destinos2019 <- recorridos_2019 %>% 
                    select(fecha_destino_recorrido, id_estacion_destino, nombre_estacion_destino,domicilio_estacion_destino,lat_estacion_destino,long_estacion_destino) %>% 
                    filter(!is.na(lat_estacion_destino))
```

```{r}
resumen_destinos2020 <- recorridos_2020 %>% 
                    select(fecha_destino_recorrido, nombre_estacion_destino,direccion_estacion_destino,lat_estacion_destino,long_estacion_destino) %>% 
                    filter(!is.na(lat_estacion_destino))
```

```{r}
destinos_2019 <- resumen_destinos2019 %>%
              mutate(nombre_estacion_destino = paste(id_estacion_destino,nombre_estacion_destino,sep="-"))%>%
              group_by(nombre_estacion_destino) %>%
              summarize(cantidad=n()) %>%
              arrange(desc(cantidad))
```




```{r}
destinos_2020 <- resumen_destinos2020 %>%
              group_by(nombre_estacion_destino) %>%
              summarize(cantidad=n()) %>%
              arrange(desc(cantidad))
head(destinos_2020)
```