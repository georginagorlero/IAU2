---
title: "Trabajo Práctico - IAU2"
output: html_document
---

# Trabajo Práctico - Instrumentos de Análisis Urbano 2

En este trabajo voy a analizar las modificaciones en el uso de las bicicletas "Ecobici" del Gobierno de la Ciudad de Buenos Aires durante la pandemia por Covid-19 en el micro y macrocentro porteño.

## 1. Primer paso - Cargar los datasets.

```{r}
library(dplyr)
library(tidyverse)
library(janitor)
library(stringr)
library(sf)
library(vroom)
library(lubridate)
library(skimr)
```

Vamos a cargar los datasets que ya trabajamos previamente en el RScript "Pruebas TP1". Nos quedamos solamente con las observaciones de la segunda quincena de junio de 2019 y la de 2020 para tener una cantidad de datos manejable. 

```{r}
recorridos_2019 <- vroom("data/recorridos_2019_jun15_30")
recorridos_2020 <- vroom("data/recorridos_2020_jun15_30")
```
También cargamos la base de datos de los barrios de la Ciudad Autónoma de Buenos Aires. 

```{r}
barrios <- st_read("data/barrios_badata.shp")
```

## 2. Segundo paso - Ordenar y procesar los datos.

Vamos a ver que información traen nuestros datos

```{r}
colnames(recorridos_2019)
```

```{r}
colnames(recorridos_2020)
```
Cuando comparamos las columnas de los datos de 2019 y 2020 vemos que son prácticamente las mismas. Podemos observar que en el dataset de 2020 las columnas domicilio pasaron a denominarse dirección. Vamos a modificarlas para que tengan el mismo nombre

```{r}
recorridos_2019 <- rename(recorridos_2019, 
                      direccion_estacion_origen = domicilio_estacion_origen,
                      direccion_estacion_destino = domicilio_estacion_destino)
```

Ya unificamos los nombres de todas las columnas en ambos datasets. Ahora podemos ver qué datos tienen nuestros datasets. 

```{r}
skim(recorridos_2019)
```
```{r}
skim(recorridos_2020)
```
Ya nos podemos ir anticipando del impacto que causó el covid en el uso de las Ecobicis viendo que la cantidad de observaciones del 2020 en relación al 2019 (41674 vs 389585)

Podemos ver también qué tipo de datos tiene cada una de las columnas y la cantidad de valores missing o nulos que hay. Vemos que la base de 2020 no tiene valores missing mientras que la de 2019 tiene una gran cantidad.

Vamos, entonces,a limpiar los valores nulos. Teniendo en cuenta que lo que más nos interesa es tener las direcciones y las coordenadas de las estaciones de origen y destino en todos los casos y que casi la totalidad de los datos que faltan son de estas variables, utilizamos el método drop_na() para realizar este procedimiento.  

```{r}
recorridos_2019 <- recorridos_2019 %>% 
                   drop_na()

skim(recorridos_2019)
```
Ahora que 

Para una primera aproximación voy a ver solamente las estaciones destino, ver cuales son las 10 estaciones más recurrentes como destino final en el 2019 y en el 2020.

Para esto primero me quedo sólo con las columnas que me interesan que son aquellas que tienen que ver con el destino de los recorridos. Además, saco todas aquellas observaciones que no tienen latitud (y por ende tampoco longitud)

```{r}
resumen_destinos2019 <- recorridos_2019_mam %>% 
                    select(fecha_destino_recorrido, id_estacion_destino, nombre_estacion_destino,direccion_estacion_destino,lat_estacion_destino,long_estacion_destino) %>% 
                    filter(!is.na(lat_estacion_destino))
```

```{r}
resumen_destinos2020 <- recorridos_2020_mam %>% 
                    select(fecha_destino_recorrido, nombre_estacion_destino,direccion_estacion_destino,lat_estacion_destino,long_estacion_destino) %>% 
                    filter(!is.na(lat_estacion_destino))
```

```{r}
destinos_2019 <- resumen_destinos2019 %>%
              mutate(nombre_estacion_destino = paste(id_estacion_destino,nombre_estacion_destino,sep=" - "))%>%
              group_by(nombre_estacion_destino) %>%
              summarize(cantidad=n()) %>%
              arrange(desc(cantidad))
```


```{r}
destinos_2020 <- resumen_destinos2020 %>%
              group_by(nombre_estacion_destino) %>%
              summarize(cantidad=n()) %>%
              arrange(desc(cantidad))
head(destinos_2020)
```